<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cellina Cloud | ÎùºÎ≤® Î∞è Ïû¨Í≥† ÏãúÏä§ÌÖú</title>
    <!-- ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&family=Nanum+Myeongjo:wght@400;700;800&family=Noto+Sans+KR:wght@400;500;700;900&family=Black+Han+Sans&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            background-color: #cbd5e1; 
            margin: 0; padding: 0; color: #1e293b;
        }
        
        /* Ïù∏ÏáÑ ÏÑ§Ï†ï */
        @media print {
            @page { 
                size: A4 landscape; 
                margin: 0; 
            }
            .no-print { display: none !important; }
            body { background: white !important; padding: 0 !important; margin: 0 !important; }
            
            #paper { 
                box-shadow: none !important; 
                border: none !important; 
                width: 100% !important; 
                margin: 0 !important; 
                padding: 0 !important; 
                display: block !important;
            }
            
            .carton-view-mode .group\/box,
            .carton-view-mode table,
            .carton-view-mode th,
            .carton-view-mode td,
            .carton-view-mode thead,
            .carton-view-mode tr,
            .carton-view-mode div,
            .carton-view-mode .print-title-bar {
                border: none !important;
                border-width: 0 !important;
                box-shadow: none !important;
                background-color: transparent !important;
            }
            
            .carton-view-mode thead { display: none !important; }

            .label-print-area {
                width: 297mm !important; 
                height: 210mm !important;
                margin: 0 !important;
                padding: 0 !important;
                border: none !important;
                box-shadow: none !important;
                position: fixed;
                top: 0; left: 0;
            }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }

        #paper {
            background: white;
            padding: 5mm; 
            margin: 30px auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border-radius: 2px;
            transition: all 0.3s ease;
            position: relative;
            box-sizing: border-box;
        }

        .tab-button {
            padding: 12px 20px; font-weight: 800; font-size: 13px;
            transition: all 0.3s; border-radius: 10px 10px 0 0;
            position: relative; bottom: -1px; display: flex; align-items: center; gap: 6px;
        }
        .tab-inactive { background: #0f172a; color: #64748b; }
        .tab-active { background: #ffffff; color: #4f46e5; border: 1px solid #e2e8f0; border-bottom: 2px solid white; }

        .color-dot-sm {
            width: 20px; height: 20px;
            border-radius: 50%; cursor: pointer;
            border: 1px solid rgba(0,0,0,0.1);
            transition: all 0.2s;
        }
        .color-dot-sm:hover { transform: scale(1.2); }

        .editor-sidebar {
            max-height: calc(100vh - 120px);
            overflow-y: auto;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .cell-textarea {
            width: 100%;
            background: transparent;
            border: none;
            outline: none;
            resize: none;
            overflow: hidden;
            line-height: 1.2;
            padding: 4px;
            display: block;
            white-space: pre-wrap;
        }

        .animate-pop { animation: pop 0.2s ease-out; }
        @keyframes pop { 0% { transform: scale(0.95); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, useCallback } = React;

        const DISTINCT_VIVID_COLORS = [
            "#EF4444", "#F97316", "#F59E0B", "#22C55E", "#3B82F6", 
            "#6366F1", "#A855F7", "#EC4899", "#06B6D4", "#1e40af"
        ];

        const COMMON_COLORS = ["#000000", "#FFFFFF", ...DISTINCT_VIVID_COLORS];

        const ICON_PATHS = {
            'cloud': <path d="M17.5 19c2.5 0 4.5-2 4.5-4.5 0-2.3-1.7-4.1-3.9-4.4C17.6 6.5 14.1 4 10 4 6.4 4 3.4 6.3 2.2 9.5 0.9 10.4 0 11.9 0 13.5 0 16.5 2.5 19 5.5 19h12z"/>,
            'search': <><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></>,
            'printer': <><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></>,
            'sheet': <><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/><line x1="9" y1="3" x2="9" y2="21"/><line x1="15" y1="3" x2="15" y2="21"/></>,
            'plus': <><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></>,
            'trash': <><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></>,
            'x': <><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></>,
            'save': <><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></>,
            'refresh': <><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></>,
            'maximize': <><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></>,
            'check': <polyline points="20 6 9 17 4 12" />,
            'layout': <><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></>,
            'folder-plus': <><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><line x1="12" y1="11" x2="12" y2="17"/><line x1="9" y1="14" x2="15" y2="14"/></>,
            'type': <><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/><line x1="12" y1="4" x2="12" y2="20"/></>,
            'settings': <><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></>
        };

        const Icon = ({ name, size = 20, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {ICON_PATHS[name] || <circle cx="12" cy="12" r="10" />}
            </svg>
        );

        const DEFAULT_SHEET_URL = "https://docs.google.com/spreadsheets/d/1bC9nm1nAUjHV1L3-B5o8wUO1VpvjFXElN4CPquxZBgU/edit?usp=sharing";
        const DEFAULT_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbztEh6MaUrD8jeRja2i2OzKr4_jNLJ2PV81G5PsKaTFY29XJJwp2vpg7V2geSBAqzU/exec";

        const INITIAL_DATA = {
            sample: { 
                title: "ÏÉòÌîå Î™©Î°ù", printCols: 2, orientation: "landscape", fontSize: 13, titleFontSize: 18, fontFamily: "'Noto Sans KR', sans-serif",
                items: [{ id: Date.now(), cat: "Í∏∞Î≥∏Î∂ÑÎ•ò", name: "ÏÉòÌîå Ï†úÌíàÎ™Ö", origin: "Íµ≠ÏÇ∞", vendor: "Í∏∞Î≥∏ Í≥µÍ∏âÏ≤ò", checked: false }], 
                themes: { "Í∏∞Î≥∏Î∂ÑÎ•ò": "#3B82F6" }, order: ["Í∏∞Î≥∏Î∂ÑÎ•ò"]
            },
            carton: { 
                title: "Ïπ¥ÌÜ§Î∞ïÏä§", printCols: 2, orientation: "landscape", fontSize: 13, titleFontSize: 18, fontFamily: "'Noto Sans KR', sans-serif",
                items: [{ id: Date.now()+1, cat: "ÏÉùÏÇ∞ÎùºÎ≤®", name: "Î∞ïÏä§ Ï†úÌíàÎ™Ö\n(Ï§ÑÎ∞îÍøà)", origin: "", vendor: "2026.12.31", checked: false }], 
                themes: { "ÏÉùÏÇ∞ÎùºÎ≤®": "#EF4444" }, order: ["ÏÉùÏÇ∞ÎùºÎ≤®"]
            }
        };

        const EditableTitle = ({ initialValue, onSave, className = "", style = {} }) => {
            const [val, setVal] = useState(initialValue);
            const [isEditing, setIsEditing] = useState(false);
            useEffect(() => { setVal(initialValue); }, [initialValue]);
            const handleBlur = () => { 
                setIsEditing(false);
                if (val !== initialValue && val.trim()) onSave(val); 
                else setVal(initialValue);
            };
            return (
                <div className={`relative flex items-center group/edit ${className}`}>
                    <input 
                        value={val} onChange={e => setVal(e.target.value)}
                        onFocus={() => setIsEditing(true)} onBlur={handleBlur}
                        onKeyDown={e => e.key === 'Enter' && e.target.blur()}
                        style={style}
                        className={`outline-none bg-transparent transition-all rounded px-1 -ml-1 w-full font-black ${isEditing ? 'bg-white/20 ring-1 ring-white/50' : 'cursor-text hover:bg-white/10'}`} 
                    />
                </div>
            );
        };

        const DualColorPicker = ({ label, colorKey, currentColor, onColorSelect }) => (
            <div className="space-y-2 p-3 bg-white border border-slate-200 rounded-xl shadow-sm">
                <div className="flex justify-between items-center mb-1">
                    <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">{label}</label>
                    <input type="color" value={currentColor} onChange={e => onColorSelect(colorKey, e.target.value)} className="w-5 h-5 p-0 border-0 cursor-pointer bg-transparent" />
                </div>
                <div className="grid grid-cols-8 gap-1">
                    {COMMON_COLORS.map(c => (
                        <div key={c} className={`color-dot-sm ${currentColor === c ? 'ring-2 ring-indigo-500 ring-offset-1' : ''}`} style={{ backgroundColor: c }} onClick={() => onColorSelect(colorKey, c)} />
                    ))}
                </div>
            </div>
        );

        const App = () => {
            const [tabData, setTabData] = useState(() => {
                const saved = localStorage.getItem('cellina_inventory_v30');
                return saved ? JSON.parse(saved) : INITIAL_DATA;
            });
            const [scriptUrl, setScriptUrl] = useState(() => {
                const saved = localStorage.getItem('cellina_script_url');
                // Í∏∞Ï°¥Ïùò Î¨∏Ï†ú ÏûàÎçò URLÎì§Ïù¥ Ï∫êÏãúÏóê ÎÇ®ÏïÑÏûàÎã§Î©¥ ÏÉà URLÎ°ú Í∞ïÏ†ú ÍµêÏ≤¥Ìï©ÎãàÎã§.
                if (!saved || 
                    saved.includes('AKfycbx-xAIb3GT5gRO69jwJu_wROo-2UuozJ8fY-MAeuEtllmAIbu_J-Uh5oPX71YJ9Omnhbw') || 
                    saved.includes('AKfycbyjJAXyAOe9ECv67zMNFzpuqjQAE8bRej1cvJsyEvs8IruAq1RpehqMYbMFMOEO_bnt') || 
                    saved.includes('AKfycbyVum5o42Ole16qY3BZYwqsWKOckFof9BsZe_KWJOobSuQpMhUelevpEYIYb7I1FRhA') ||
                    saved.includes('AKfycby6ZjZNiuLSGbu61_QvoiH_HmIesdEK9GR0lLq2iP0CL-XzaYF7VczqYXGAd1pZGsGb')) {
                    return DEFAULT_SCRIPT_URL;
                }
                return saved;
            });
            const [sheetUrl, setSheetUrl] = useState(() => localStorage.getItem('cellina_sheet_url') || DEFAULT_SHEET_URL);

            const [activeTab, setActiveTab] = useState("sample");
            const [searchTerm, setSearchTerm] = useState("");
            const [labelModal, setLabelModal] = useState(null);
            const [isSavingInProgress, setIsSavingInProgress] = useState(false);
            const [isConfigOpen, setIsConfigOpen] = useState(false);
            const [isFetching, setIsFetching] = useState(false);

            // Ïã§Ï†ú Íµ¨Í∏Ä ÏãúÌä∏ ÌÉ≠ Ïù¥Î¶ÑÍ≥º ÎÇ¥Î∂Ä ÏÉÅÌÉú Ïù¥Î¶Ñ Îß§Ìïë
            const tabNameMapping = {
                'sample': 'ÏÉòÌîåÎ™©Î°ù',
                'carton': 'Ïπ¥ÌÜ§Î∞ïÏä§'
            };

            useEffect(() => {
                localStorage.setItem('cellina_inventory_v30', JSON.stringify(tabData));
                localStorage.setItem('cellina_script_url', scriptUrl);
                localStorage.setItem('cellina_sheet_url', sheetUrl);
            }, [tabData, scriptUrl, sheetUrl]);

            const current = tabData[activeTab];

            const filteredItems = useMemo(() => {
                const term = searchTerm.toLowerCase();
                if (!term) return current.items;
                return current.items.filter(item => 
                    item.name.toLowerCase().includes(term) || 
                    item.cat.toLowerCase().includes(term) ||
                    item.vendor.toLowerCase().includes(term) ||
                    item.origin.toLowerCase().includes(term)
                );
            }, [current.items, searchTerm]);

            const updateCurrentData = (updates) => {
                setTabData(prev => ({ ...prev, [activeTab]: { ...prev[activeTab], ...updates } }));
            };

            const editItem = (id, f, v) => {
                const nextItems = current.items.map(i => i.id === id ? { ...i, [f]: v } : i);
                updateCurrentData({ items: nextItems });
            };

            const renameCategory = (oldName, newName) => {
                if (!newName || oldName === newName) return;
                const nextItems = current.items.map(i => i.cat === oldName ? { ...i, cat: newName } : i);
                const nextOrder = current.order.map(c => c === oldName ? newName : c);
                const nextThemes = { ...current.themes };
                if (nextThemes[oldName]) {
                    nextThemes[newName] = nextThemes[oldName];
                    delete nextThemes[oldName];
                }
                updateCurrentData({ items: nextItems, order: nextOrder, themes: nextThemes });
            };

            const addNewCategory = () => {
                const newCatName = prompt("ÏÉàÎ°úÏö¥ Î∂ÑÎ•òÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî. (Î∞ïÏä§ Ï†úÎ™©Ïù¥ Îê©ÎãàÎã§)");
                if (!newCatName || current.order.includes(newCatName)) return;
                const nextOrder = [newCatName, ...current.order];
                const nextThemes = { ...current.themes };
                nextThemes[newCatName] = DISTINCT_VIVID_COLORS[nextOrder.length % DISTINCT_VIVID_COLORS.length];
                const newItem = { id: Date.now(), cat: newCatName, name: "", origin: "", vendor: "", checked: false };
                updateCurrentData({ items: [newItem, ...current.items], order: nextOrder, themes: nextThemes });
            };

            const openLabelMaker = (item) => {
                const isSingle = item.cat === 'Î∞ïÏä§ÎùºÎ≤®';
                const footerTextVal = activeTab === 'carton' ? item.vendor : `${item.origin} / ${item.vendor}`;
                const config = item.labelSettings || {
                    mainText: item.name, footerText: isSingle ? "" : footerTextVal,
                    bgTop: "#EF4444", bgBottom: "#FFFFFF", colorTop: "#FFFFFF", colorBottom: "#000000",
                    fontFamily: "'Noto Sans KR', sans-serif", mainSize: 140, footerSize: 90, isSingleZone: isSingle
                };
                setLabelModal({ ...config, itemId: item.id });
            };

            const saveLabelSettings = () => {
                setIsSavingInProgress(true);
                const nextItems = current.items.map(i => 
                    i.id === labelModal.itemId 
                    ? { ...i, name: labelModal.mainText, labelSettings: { ...labelModal } } 
                    : i
                );
                updateCurrentData({ items: nextItems });
                setTimeout(() => setIsSavingInProgress(false), 800);
            };

            // Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ ÏßÑÎã® Î°úÏßÅ ÏôÑÏ†Ñ Î≥¥Í∞ï Î∞è Í≥µÎ∞± Ï†úÍ±∞ Ï≤òÎ¶¨
            const fetchDataFromSheet = async () => {
                const cleanScriptUrl = (scriptUrl || "").trim();
                const cleanSheetUrl = (sheetUrl || "").trim();
                
                if (!cleanScriptUrl) { alert("ÌôòÍ≤ΩÏÑ§Ï†ï(ÌÜ±ÎãàÎ∞îÌÄ¥)ÏóêÏÑú Ïï±Ïä§ Ïä§ÌÅ¨Î¶ΩÌä∏ Ï£ºÏÜåÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."); return; }
                if (!cleanSheetUrl) { alert("ÌôòÍ≤ΩÏÑ§Ï†ïÏóêÏÑú Íµ¨Í∏Ä ÏãúÌä∏ Ï£ºÏÜåÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."); return; }
                
                setIsFetching(true);
                
                try {
                    const sheetTabName = tabNameMapping[activeTab];
                    
                    const fetchUrl = `${cleanScriptUrl}?action=read&tab=${encodeURIComponent(sheetTabName)}&sheetUrl=${encodeURIComponent(cleanSheetUrl)}&t=${Date.now()}`;
                    
                    console.log("ÏöîÏ≤≠ URL:", fetchUrl); // ÏΩòÏÜîÏ∞Ω(F12) ÎîîÎ≤ÑÍπÖÏö©

                    const res = await fetch(fetchUrl, {
                        method: 'GET',
                        redirect: 'follow'
                    });
                    
                    const text = await res.text();
                    console.log("ÏùëÎãµ Îç∞Ïù¥ÌÑ∞:", text); // ÏΩòÏÜîÏ∞Ω(F12) ÎîîÎ≤ÑÍπÖÏö©
                    
                    if (text.trim().startsWith("<!DOCTYPE") || text.trim().startsWith("<html")) {
                        alert("‚ö†Ô∏è Íµ¨Í∏Ä ÏãúÌä∏ Ïó∞Îèô Ïò§Î•ò (Í∂åÌïú Î¨∏Ï†ú)\n\nÏõêÏù∏: Ïï±Ïä§ Ïä§ÌÅ¨Î¶ΩÌä∏ Î∞∞Ìè¨ Ïãú Ïï°ÏÑ∏Ïä§ Í∂åÌïúÏùÑ 'Î™®Îì† ÏÇ¨Ïö©Ïûê'Î°ú ÏÑ§Ï†ïÌïòÏßÄ ÏïäÏïòÏäµÎãàÎã§.\nÌï¥Í≤∞: Íµ¨Í∏Ä Ïä§ÌÅ¨Î¶ΩÌä∏ Ï∞Ω Ïö∞Ï∏° ÏÉÅÎã® [Î∞∞Ìè¨ Í¥ÄÎ¶¨] -> Ïó∞ÌïÑ ÏïÑÏù¥ÏΩò -> Ïï°ÏÑ∏Ïä§Ìï† Ïàò ÏûàÎäî ÏÇ¨Ïö©Ïûê: 'Î™®Îì† ÏÇ¨Ïö©Ïûê'Î°ú Î≥ÄÍ≤Ω ÌõÑ ÏÉà Î≤ÑÏ†ÑÏúºÎ°ú Î∞∞Ìè¨Ìï¥Ï£ºÏÑ∏Ïöî.");
                        setIsFetching(false);
                        return;
                    }

                    if (!text) {
                        alert("‚ö†Ô∏è Íµ¨Í∏Ä ÏÑúÎ≤ÑÎ°úÎ∂ÄÌÑ∞ Îπà ÏùëÎãµÏù¥ ÎèåÏïÑÏôîÏäµÎãàÎã§. Ïä§ÌÅ¨Î¶ΩÌä∏ Ï£ºÏÜåÎÇò ÏΩîÎìúÎ•º Îã§Ïãú ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.");
                        setIsFetching(false);
                        return;
                    }

                    let data;
                    try {
                        data = JSON.parse(text);
                    } catch(e) {
                        alert("‚ö†Ô∏è ÏùëÎãµ Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù Ïò§Î•ò\n\nÍµ¨Í∏Ä ÏÑúÎ≤ÑÏóêÏÑú Ïò¨Î∞îÎ•∏ Îç∞Ïù¥ÌÑ∞(JSON)Î•º Î∞òÌôòÌïòÏßÄ ÏïäÏïòÏäµÎãàÎã§.\n(Íµ¨Í∏Ä Ïä§ÌÅ¨Î¶ΩÌä∏Í∞Ä 'Í≥ºÍ±∞ Î≤ÑÏ†Ñ'Ïùº Ïàò ÏûàÏäµÎãàÎã§. ÏúÑÏóê ÏïàÎÇ¥Îêú ÏÉà ÏΩîÎìúÎ°ú ÍµêÏ≤¥ ÌõÑ [ÏÉà Î∞∞Ìè¨]Î•º ÏßÑÌñâÌï¥ Ï£ºÏÑ∏Ïöî.)");
                        setIsFetching(false);
                        return;
                    }

                    if (data && data.error) {
                        alert(`‚ö†Ô∏è Íµ¨Í∏Ä ÏãúÌä∏ ÎÇ¥Î∂Ä ÏóêÎü¨ Î∞úÏÉù!\n\n${data.error}\n\n-> ÏóëÏÖÄ ÌååÏùº ÌïòÎã®Ïóê [${sheetTabName}] ÌÉ≠Ïù¥ ÏûàÎäîÏßÄ, Ï£ºÏÜåÍ∞Ä Ï†ïÌôïÌïúÏßÄ ÌôïÏù∏ÌïòÏÑ∏Ïöî.`);
                        setIsFetching(false);
                        return;
                    }

                    if (Array.isArray(data)) {
                        if (data.length <= 1) {
                            alert(`[${sheetTabName}] ÌÉ≠Ïù¥ ÎπÑÏñ¥ ÏûàÍ±∞ÎÇò Ï†úÎ™©(1Ìñâ)Îßå ÏûàÏäµÎãàÎã§. Í∞ÄÏ†∏Ïò¨ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.`);
                            setIsFetching(false);
                            return;
                        }

                        const dataRows = data.slice(1);
                        const validRows = dataRows.filter(row => row[0] || row[1] || row[2] || row[3]);

                        const newItems = validRows.map((row, idx) => ({
                            id: Date.now() + idx,
                            cat: row[0] ? String(row[0]).trim() : "Í∏∞Î≥∏Î∂ÑÎ•ò",
                            name: row[1] ? String(row[1]).trim() : "",
                            origin: row[2] ? String(row[2]).trim() : "",
                            vendor: row[3] ? String(row[3]).trim() : "",
                            checked: false
                        }));

                        const uniqueCats = [...new Set(newItems.map(i => i.cat))];
                        const newThemes = { ...current.themes };
                        uniqueCats.forEach((c, idx) => { 
                            if (!newThemes[c]) newThemes[c] = DISTINCT_VIVID_COLORS[idx % DISTINCT_VIVID_COLORS.length]; 
                        });
                        
                        updateCurrentData({ items: newItems, order: uniqueCats, themes: newThemes });
                        alert(`‚úÖ [${sheetTabName}] ÌÉ≠ÏóêÏÑú ÏµúÏã† Îç∞Ïù¥ÌÑ∞ ${validRows.length}Í∞úÎ•º ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î∂àÎü¨ÏôîÏäµÎãàÎã§!`);
                    } else {
                        alert("‚ö†Ô∏è Îç∞Ïù¥ÌÑ∞ ÌòïÏãùÏù¥ Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.");
                    }
                } catch (err) { 
                    console.error("Fetch Error:", err);
                    alert("‚ö†Ô∏è ÌÜµÏã† Ïã§Ìå® (ÎÑ§Ìä∏ÏõåÌÅ¨ Ï∞®Îã® ÎòêÎäî ÏÑúÎ≤Ñ Ï£ºÏÜå Ïò§Î•ò)\n\nÏÉÅÏÑ∏ ÏõêÏù∏: " + err.message + "\n\nüí° Î∏åÎùºÏö∞Ï†ÄÍ∞Ä ÌÜµÏã†ÏùÑ Ï∞®Îã®ÌñàÍ±∞ÎÇò Íµ¨Í∏Ä Ïï±Ïä§ Ïä§ÌÅ¨Î¶ΩÌä∏ Ï£ºÏÜåÍ∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§."); 
                }
                
                setIsFetching(false);
            };

            // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• ÏßÑÎã® Î°úÏßÅ Ï∂îÍ∞Ä Î∞è Í≥µÎ∞± Ï†úÍ±∞ Ï≤òÎ¶¨
            const pushToGoogleSheet = async () => {
                const cleanScriptUrl = (scriptUrl || "").trim();
                const cleanSheetUrl = (sheetUrl || "").trim();

                if (!cleanScriptUrl || !cleanSheetUrl) { alert("ÌôòÍ≤ΩÏÑ§Ï†ï(‚öôÔ∏è)ÏóêÏÑú Ï£ºÏÜåÎ•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."); return; }
                
                setIsSavingInProgress(true);
                try {
                    const pushData = current.items.map(item => [item.cat, item.name, item.origin || "", item.vendor || ""]);
                    pushData.unshift(["Î∂ÑÎ•ò", "Ï†úÌíàÎ™Ö", "ÏõêÏÇ∞ÏßÄ", "Í≥µÍ∏âÏ≤ò"]); // Ìó§Îçî Ï∂îÍ∞Ä

                    const sheetTabName = tabNameMapping[activeTab]; 
                    const payload = {
                        tab: sheetTabName,
                        sheetUrl: cleanSheetUrl,
                        data: pushData
                    };
                    
                    const res = await fetch(cleanScriptUrl, {
                        method: "POST",
                        body: JSON.stringify(payload)
                    });
                    
                    const text = await res.text();
                    let result;
                    try {
                        result = JSON.parse(text);
                    } catch(e) {
                        // Íµ¨Í∏Ä Ïä§ÌÅ¨Î¶ΩÌä∏ ÌôòÍ≤Ω ÌäπÏÑ±ÏÉÅ redirect/HTML ÏùëÎãµÏù¥ Ïò¨ Ïàò ÏûàÏùå
                    }

                    if (result && result.status === 'error') {
                        alert("‚ö†Ô∏è ÏãúÌä∏ Ï†ÄÏû• Ïã§Ìå®\nÏõêÏù∏: " + result.message);
                    } else {
                        alert(`‚úÖ Íµ¨Í∏Ä ÏãúÌä∏ [${sheetTabName}] ÌÉ≠Ïóê ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!`);
                    }
                } catch (err) { 
                    alert("‚ö†Ô∏è Ï†ÄÏû• Ï§ë ÌÜµÏã† Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.\n\n" + err.message); 
                }
                setIsSavingInProgress(false);
            };

            const splitBlocks = useMemo(() => {
                const limit = current.orientation === 'landscape' ? 17 : 32;
                let result = [];
                current.order.forEach(cat => {
                    const catItems = filteredItems.filter(i => i.cat === cat);
                    if (catItems.length === 0 && !searchTerm) {
                        result.push({ id: `${cat}-empty`, originalCat: cat, title: cat, items: [], theme: current.themes[cat] });
                    } else if (catItems.length > 0) {
                        for (let i = 0; i < catItems.length; i += limit) {
                            result.push({ id: `${cat}-${i}`, originalCat: cat, title: cat, items: catItems.slice(i, i + limit), theme: current.themes[cat] });
                        }
                    }
                });
                return result;
            }, [current, filteredItems, searchTerm]);

            return (
                <div className="min-h-screen flex flex-col bg-slate-100">
                    <header className="no-print bg-slate-900 text-white shadow-xl z-50 sticky top-0 border-b border-slate-700">
                        <div className="max-w-[1600px] mx-auto p-3 flex justify-between items-center gap-4">
                            <div className="flex items-center gap-3 shrink-0">
                                <div className="bg-indigo-600 p-2 rounded-lg shadow-lg shadow-indigo-500/20"><Icon name="cloud" size={18} /></div>
                                <h1 className="text-md font-black tracking-tighter uppercase">Cellina Cloud</h1>
                            </div>

                            {!labelModal && (
                                <div className="flex-1 max-w-md relative group">
                                    <Icon name="search" size={14} className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-indigo-400 transition-colors" />
                                    <input 
                                        type="text" placeholder="Ï†úÌíàÎ™Ö, Î∂ÑÎ•ò, Í≥µÍ∏âÏ≤ò ÌÜµÌï© Í≤ÄÏÉâ..." 
                                        value={searchTerm} onChange={e => setSearchTerm(e.target.value)}
                                        className="w-full bg-slate-800 border-none rounded-xl pl-9 pr-10 py-2.5 text-xs outline-none ring-2 ring-transparent focus:ring-indigo-500 transition-all focus:bg-slate-950"
                                    />
                                    {searchTerm && <button onClick={()=>setSearchTerm("")} className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-white"><Icon name="x" size={14} /></button>}
                                </div>
                            )}

                            <div className="flex items-center gap-2 shrink-0">
                                {!labelModal ? (
                                    <>
                                        <div className="flex bg-slate-800 rounded-lg p-1 gap-4 items-center px-4 border border-slate-700">
                                            <div className="flex items-center gap-2" title="Î∞ïÏä§ Ï†úÎ™©(Î∂ÑÎ•ò) ÌÅ¨Í∏∞">
                                                <span className="text-[9px] font-bold text-slate-500 uppercase">T</span>
                                                <input type="range" min="10" max="40" value={current.titleFontSize} onChange={e => updateCurrentData({ titleFontSize: parseInt(e.target.value) })} className="w-16 h-1 accent-indigo-500" />
                                            </div>
                                            <div className="flex items-center gap-2" title="ÌÖåÏù¥Î∏î Î≥∏Î¨∏ ÌÅ¨Í∏∞">
                                                <span className="text-[9px] font-bold text-slate-500 uppercase">C</span>
                                                <input type="range" min="8" max="25" value={current.fontSize} onChange={e => updateCurrentData({ fontSize: parseInt(e.target.value) })} className="w-16 h-1 accent-emerald-500" />
                                            </div>
                                        </div>

                                        <div className="flex bg-slate-800 rounded-lg p-1 gap-1 border border-slate-700">
                                            <button onClick={addNewCategory} className="bg-indigo-600 hover:bg-indigo-500 px-3 py-1.5 rounded font-bold text-[10px] flex items-center gap-2 transition-all shadow-sm">
                                                <Icon name="folder-plus" size={12} /> Î∂ÑÎ•ò Ï∂îÍ∞Ä
                                            </button>
                                            <button onClick={fetchDataFromSheet} disabled={isFetching} className={`hover:bg-slate-700 px-3 py-1.5 rounded font-bold text-[10px] flex items-center gap-2 transition-all ${isFetching ? 'opacity-50 cursor-wait' : ''}`}>
                                                <Icon name="refresh" size={12} className={isFetching ? "animate-spin text-indigo-400" : ""} /> {isFetching ? 'Í∞ÄÏ†∏Ïò§ÎäîÏ§ë...' : 'ÏãúÌä∏ Í∞±Ïã†'}
                                            </button>
                                            <button onClick={() => updateCurrentData({ orientation: current.orientation === 'landscape' ? 'portrait' : 'landscape' })} className="hover:bg-slate-700 px-2 py-1.5 rounded font-bold text-[10px] flex items-center gap-2">
                                                <Icon name="maximize" size={12} /> {current.orientation === 'landscape' ? 'Í∞ÄÎ°ú' : 'ÏÑ∏Î°ú'}
                                            </button>
                                        </div>
                                        
                                        <button onClick={pushToGoogleSheet} disabled={isSavingInProgress} className={`bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded font-bold text-[11px] flex items-center gap-2 transition-all ${isSavingInProgress ? 'opacity-50 cursor-wait' : ''}`}><Icon name="save" size={12} className={isSavingInProgress ? "animate-bounce" : ""} /> {isSavingInProgress ? 'Ï†ÄÏû•Ï§ë...' : 'Ï†ÄÏû•'}</button>
                                        <button onClick={() => window.print()} className="bg-white text-slate-900 px-4 py-2 rounded font-black flex items-center gap-2 text-[11px] hover:bg-slate-100 transition-all"><Icon name="printer" size={12} /> Ïù∏ÏáÑ</button>
                                        <button onClick={() => setIsConfigOpen(!isConfigOpen)} className={`p-2 rounded-lg transition-colors ${isConfigOpen ? 'bg-indigo-600 text-white' : 'text-slate-400 hover:text-white'}`}><Icon name="settings" size={18} /></button>
                                    </>
                                ) : (
                                    <>
                                        <button onClick={saveLabelSettings} className="px-5 py-2 rounded-xl font-black flex items-center gap-2 transition-all text-xs bg-blue-600 hover:bg-blue-500">
                                            <Icon name="save" size={14} /> ÏÑ§Ï†ï Ï†ÄÏû•
                                        </button>
                                        <button onClick={() => window.print()} className="bg-indigo-600 px-5 py-2 rounded-xl font-black flex items-center gap-2 text-xs transition-all"><Icon name="printer" size={14} /> ÎùºÎ≤® Ïù∏ÏáÑ</button>
                                        <button onClick={() => setLabelModal(null)} className="bg-slate-700 px-4 py-2 rounded-xl font-bold text-xs hover:bg-slate-600">Î™©Î°ù Î≥µÍ∑Ä</button>
                                    </>
                                )}
                            </div>
                        </div>

                        {/* ÏãúÌä∏ Ïó∞Îèô ÏÑ§Ï†ïÏ∞Ω */}
                        {isConfigOpen && (
                            <div className="absolute top-16 right-6 bg-slate-800 border border-slate-700 shadow-2xl rounded-2xl p-5 w-[420px] animate-pop no-print">
                                <h3 className="text-xs font-black text-indigo-400 mb-4 flex items-center gap-2 uppercase tracking-tighter"><Icon name="settings" size={14}/> Íµ¨Í∏Ä ÏãúÌä∏ Ïó∞Îèô ÏÑ§Ï†ï</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="text-[10px] font-bold text-slate-500 block mb-1">Ïï±Ïä§ Ïä§ÌÅ¨Î¶ΩÌä∏ API Ï£ºÏÜå</label>
                                        <input value={scriptUrl} onChange={e=>setScriptUrl(e.target.value)} placeholder="https://script.google.com/macros/s/..." className="w-full bg-slate-900 border-none rounded-lg p-3 text-[10px] font-mono text-indigo-300 outline-none ring-1 ring-white/5 focus:ring-indigo-500 transition-all" />
                                    </div>
                                    <div>
                                        <label className="text-[10px] font-bold text-slate-500 block mb-1">Íµ¨Í∏Ä ÏãúÌä∏ Ïã§Ï†ú Ï£ºÏÜå (Î∞îÎ°úÍ∞ÄÍ∏∞Ïö©)</label>
                                        <input value={sheetUrl} onChange={e=>setSheetUrl(e.target.value)} placeholder="https://docs.google.com/spreadsheets/d/..." className="w-full bg-slate-900 border-none rounded-lg p-3 text-[10px] font-mono text-slate-400 outline-none ring-1 ring-white/5" />
                                    </div>
                                    <div className="flex gap-2 pt-2">
                                        <a href={sheetUrl} target="_blank" className="flex-1 bg-slate-700 py-3 rounded-xl font-bold text-[11px] text-center hover:bg-slate-600 transition-colors">Íµ¨Í∏Ä ÏãúÌä∏ Ïó¥Í∏∞</a>
                                        <button onClick={()=>setIsConfigOpen(false)} className="flex-1 bg-indigo-600 py-3 rounded-xl font-bold text-[11px] hover:bg-indigo-500 shadow-lg shadow-indigo-500/30">ÏÑ§Ï†ï Îã´Í∏∞</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {!labelModal && (
                            <div className="px-6 flex gap-2 overflow-x-auto no-scrollbar border-t border-slate-800 bg-slate-900/50">
                                {Object.keys(tabData).map(key => (
                                    <button key={key} onClick={() => setActiveTab(key)} className={`tab-button min-w-[100px] ${activeTab === key ? 'tab-active' : 'tab-inactive'}`}>
                                        <span className="uppercase tracking-tighter">{tabData[key].title}</span>
                                    </button>
                                ))}
                            </div>
                        )}
                    </header>

                    <main className="flex-1 overflow-y-auto">
                        {!labelModal ? (
                            <div id="paper" className={activeTab === 'carton' ? 'carton-view-mode' : ''} style={{ width: current.orientation === 'portrait' ? '210mm' : '297mm' }}>
                                <div className={`grid gap-8 ${current.printCols === 1 ? 'grid-cols-1' : 'grid-cols-2'}`}>
                                    {splitBlocks.map((block) => (
                                        <div key={block.id} className="group/box rounded-xl overflow-hidden bg-white border-2 border-slate-900 break-inside-avoid shadow-lg transition-transform">
                                            {/* Î∂ÑÎ•ò Î∞ïÏä§ Ï†úÎ™© */}
                                            <div style={{ backgroundColor: block.theme, padding: '10px 14px' }} className="text-white font-black flex justify-between items-center print:hidden">
                                                <EditableTitle 
                                                    initialValue={block.title} 
                                                    onSave={(v) => renameCategory(block.originalCat, v)} 
                                                    style={{ fontSize: `${current.titleFontSize}px` }}
                                                    className="flex-1" 
                                                />
                                                <div className="flex items-center gap-2">
                                                    <button onClick={() => {
                                                        const newItem = { id: Date.now(), cat: block.originalCat, name: "", origin: "", vendor: "", checked: false };
                                                        updateCurrentData({ items: [newItem, ...current.items] });
                                                    }} className="bg-white/20 p-1 rounded hover:bg-white/40"><Icon name="plus" size={14}/></button>
                                                    <input type="color" value={block.theme} onChange={(e) => setTabData(prev => ({...prev, [activeTab]: {...prev[activeTab], themes: {...prev[activeTab].themes, [block.originalCat]: e.target.value}}}))} className="w-5 h-5 cursor-pointer bg-transparent border-0" />
                                                    <button onClick={() => {
                                                        if(confirm(`'${block.title}' Î∂ÑÎ•òÏôÄ ÎÇ¥Î∂Ä Ìï≠Î™©ÏùÑ ÏÇ≠Ï†úÌï†ÍπåÏöî?`)) {
                                                            const nextItems = current.items.filter(i => i.cat !== block.originalCat);
                                                            const nextOrder = current.order.filter(c => c !== block.originalCat);
                                                            updateCurrentData({ items: nextItems, order: nextOrder });
                                                        }
                                                    }} className="bg-white/20 p-1 rounded hover:bg-red-500/40"><Icon name="trash" size={14}/></button>
                                                </div>
                                            </div>
                                            <div style={{ backgroundColor: block.theme, fontSize: `${current.titleFontSize}px`, padding: '12px' }} className="hidden print:block text-white font-black text-center border-b-2 border-slate-900">{block.title}</div>
                                            
                                            {/* Îç∞Ïù¥ÌÑ∞ ÌÖåÏù¥Î∏î */}
                                            <table className="w-full border-collapse" style={{ fontSize: `${current.fontSize}px` }}>
                                                <thead className="bg-slate-50 border-b-2 border-slate-900 font-bold text-center">
                                                    <tr>
                                                        <th className="w-8 border-r border-slate-900 py-2">V</th>
                                                        <th className="px-2 border-r border-slate-900">Ï†úÌíàÎ™Ö</th>
                                                        {activeTab !== 'carton' && <th className="w-24 px-2 border-r border-slate-900">ÏõêÏÇ∞ÏßÄ</th>}
                                                        <th className="w-32 px-2">{activeTab === 'carton' ? 'ÏÜåÎπÑÍ∏∞Ìïú' : 'Í≥µÍ∏âÏ≤ò'}</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {block.items.length === 0 ? (
                                                        <tr><td colSpan={activeTab === 'carton' ? "3" : "4"} className="py-6 text-center text-slate-300 italic font-medium">Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</td></tr>
                                                    ) : (
                                                        block.items.map(item => (
                                                            <tr key={item.id} className="border-b border-slate-200 group/row hover:bg-slate-50 transition-colors">
                                                                <td className="text-center py-1 border-r border-slate-200 align-top pt-2.5"><input type="checkbox" checked={item.checked} onChange={() => editItem(item.id, 'checked', !item.checked)} className="mx-auto block cursor-pointer" style={{width:'15px', height:'15px'}} /></td>
                                                                <td className="border-r border-slate-200 align-top">
                                                                    <div className="flex items-start justify-between min-h-[36px]">
                                                                        <textarea 
                                                                            value={item.name} 
                                                                            onChange={e => editItem(item.id, 'name', e.target.value)} 
                                                                            className="cell-textarea font-black text-slate-800"
                                                                            placeholder="Ï†úÌíàÎ™Ö"
                                                                            rows={item.name.split('\n').length || 1}
                                                                        />
                                                                        <div className="flex gap-1 no-print opacity-0 group-hover/row:opacity-100 transition-opacity p-1.5 shrink-0">
                                                                            {activeTab === 'carton' && <button onClick={() => openLabelMaker(item)} className="text-indigo-500 hover:scale-125 transition-transform"><Icon name="printer" size={14}/></button>}
                                                                            <button onClick={() => updateCurrentData({ items: current.items.filter(i => i.id !== item.id) })} className="text-red-400 hover:scale-125 transition-transform"><Icon name="trash" size={14}/></button>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                {activeTab !== 'carton' && (
                                                                    <td className="border-r border-slate-200 align-top text-center">
                                                                        <textarea value={item.origin} onChange={e => editItem(item.id, 'origin', e.target.value)} className="cell-textarea text-center font-medium" placeholder="ÏõêÏÇ∞ÏßÄ" rows={item.origin.split('\n').length || 1} />
                                                                    </td>
                                                                )}
                                                                <td className="align-top text-center">
                                                                    <textarea value={item.vendor} onChange={e => editItem(item.id, 'vendor', e.target.value)} className="cell-textarea text-center text-slate-500" placeholder={activeTab === 'carton' ? 'ÏÜåÎπÑÍ∏∞Ìïú' : 'Í≥µÍ∏âÏ≤ò'} rows={item.vendor.split('\n').length || 1} />
                                                                </td>
                                                            </tr>
                                                        ))
                                                    )}
                                                </tbody>
                                            </table>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ) : (
                            <div className="flex flex-col lg:flex-row gap-6 p-6 max-w-[1600px] mx-auto items-start">
                                <div className="flex-1 bg-slate-300 p-8 rounded-3xl shadow-inner w-full flex justify-center sticky top-24">
                                    <div className="label-print-area bg-white shadow-2xl overflow-hidden" style={{ width: '280mm', height: '190mm', fontFamily: labelModal.fontFamily, zoom: '0.6' }}>
                                        <div style={{ backgroundColor: labelModal.bgTop, color: labelModal.colorTop, height: labelModal.isSingleZone ? '100%' : '72%' }} className="flex flex-col justify-center items-center p-12 text-center transition-all">
                                            <div style={{ fontSize: `${labelModal.mainSize}px`, fontWeight: '900', lineHeight: '1.1', whiteSpace: 'pre-wrap' }}>{labelModal.mainText}</div>
                                        </div>
                                        {!labelModal.isSingleZone && (
                                            <div style={{ backgroundColor: labelModal.bgBottom, color: labelModal.colorBottom, height: '28%' }} className="flex justify-center items-center border-t-4 border-black/10">
                                                <div style={{ fontSize: `${labelModal.footerSize}px`, fontWeight: '900' }}>{labelModal.footerText}</div>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                <div className="w-full lg:w-[400px] space-y-4 no-print editor-sidebar">
                                    <div className="bg-white p-5 rounded-2xl shadow-md border border-slate-200">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="font-black text-sm uppercase text-slate-500">ÎùºÎ≤® Íµ¨ÏÑ±</h3>
                                            <button onClick={() => setLabelModal(null)} className="text-slate-400 hover:text-red-500"><Icon name="x" size={20}/></button>
                                        </div>
                                        <div className="flex bg-slate-100 p-1 rounded-xl mb-4">
                                            <button onClick={() => setLabelModal({...labelModal, isSingleZone: false})} className={`flex-1 py-2 text-[10px] font-black rounded-lg transition-all ${!labelModal.isSingleZone ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-400'}`}>2Îã® Î™®Îìú</button>
                                            <button onClick={() => setLabelModal({...labelModal, isSingleZone: true})} className={`flex-1 py-2 text-[10px] font-black rounded-lg transition-all ${labelModal.isSingleZone ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-400'}`}>1Îã® Î™®Îìú</button>
                                        </div>
                                        <div className="space-y-4">
                                            <textarea value={labelModal.mainText} onChange={e => setLabelModal({...labelModal, mainText: e.target.value})} className="w-full border p-3 rounded-xl h-24 font-bold text-sm bg-slate-50 focus:ring-2 ring-indigo-500 outline-none" />
                                            {!labelModal.isSingleZone && (
                                                <input value={labelModal.footerText} onChange={e => setLabelModal({...labelModal, footerText: e.target.value})} className="w-full border p-3 rounded-xl font-bold text-sm bg-slate-50" />
                                            )}
                                        </div>
                                    </div>

                                    <div className="bg-white p-5 rounded-2xl shadow-md border border-slate-200 space-y-4">
                                        <h3 className="font-black text-[10px] uppercase text-slate-400">ÏÉâÏÉÅ Ïª§Ïä§ÌÖÄ</h3>
                                        <DualColorPicker label="ÎùºÎ≤® Î∞∞Í≤Ω" colorKey="bgTop" currentColor={labelModal.bgTop} onColorSelect={(k,v) => setLabelModal({...labelModal, [k]:v})} />
                                        <DualColorPicker label="ÌÖçÏä§Ìä∏ ÏÉâÏÉÅ" colorKey="colorTop" currentColor={labelModal.colorTop} onColorSelect={(k,v) => setLabelModal({...labelModal, [k]:v})} />
                                        <select value={labelModal.fontFamily} onChange={e => setLabelModal({...labelModal, fontFamily: e.target.value})} className="w-full p-3 bg-slate-100 rounded-xl font-black text-sm outline-none">
                                            <option value="'Noto Sans KR', sans-serif">Î≥∏Í≥†Îîï</option>
                                            <option value="'Black Han Sans', sans-serif">Í≤ÄÏùÄÍ≥†Îîï</option>
                                            <option value="'Nanum Gothic', sans-serif">ÎÇòÎàîÍ≥†Îîï</option>
                                        </select>
                                    </div>

                                    <div className="bg-white p-5 rounded-2xl shadow-md border border-slate-200 space-y-4">
                                        <h3 className="font-black text-[10px] uppercase text-slate-400">ÏÇ¨Ïù¥Ï¶à Ï°∞Ï†à</h3>
                                        <div className="space-y-4">
                                            <div className="space-y-1">
                                                <div className="flex justify-between text-[10px] font-black"><span>Î©îÏù∏ ÌÖçÏä§Ìä∏</span><span>{labelModal.mainSize}px</span></div>
                                                <input type="range" min="40" max="600" value={labelModal.mainSize} onChange={e => setLabelModal({...labelModal, mainSize: parseInt(e.target.value)})} className="w-full accent-indigo-600" />
                                            </div>
                                            {!labelModal.isSingleZone && (
                                                <div className="space-y-1">
                                                    <div className="flex justify-between text-[10px] font-black"><span>ÌïòÎã® ÌÖçÏä§Ìä∏</span><span>{labelModal.footerSize}px</span></div>
                                                    <input type="range" min="20" max="400" value={labelModal.footerSize} onChange={e => setLabelModal({...labelModal, footerSize: parseInt(e.target.value)})} className="w-full accent-indigo-600" />
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    <button onClick={saveLabelSettings} className="w-full bg-blue-600 text-white py-4 rounded-2xl font-black shadow-lg hover:bg-blue-700 transition-all">ÏÑ§Ï†ï Ï†ÅÏö©</button>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
